version: '3.7'

services:
  master:
    build:
      context: jacsstorage-masterweb/
      args:
        - TAG_JACS=master
    ports:
      - '9880:8080'
    volumes:
      - jadeconf:/etc/jadeconf.d
    environment:
      - JACSSTORAGE_CONFIG=/etc/jadeconf.d/jadeconf.properties
      - JACSSTORAGE_LOG_CONFIG=/etc/jadeconf.d/logback-master.xml
    command:
      - '/app/jacsstorage-masterweb/bin/jacsstorage-masterweb'
      - '-b'
      - '0.0.0.0'

  agent:
    build:
      context: jacsstorage-agentweb/
      args:
        - TAG_JACS=master
    depends_on:
    - master
    expose:
      - '8081'
    volumes:
    - jadeconf:/etc/jadeconf.d
    environment:
    - JACSSTORAGE_CONFIG=/etc/jadeconf.d/jadeconf.properties
    - JACSSTORAGE_LOG_CONFIG=/etc/jadeconf.d/logback-agent.xml
    command:
      - '/app/jacsstorage-agentweb/bin/jacsstorage-agentweb'
      - '-b'
      - '0.0.0.0'
      - '-p'
      - '8081'
      - '-masterURL'
      - 'http://jacs-storage_master_1:8080/jacsstorage/master_api/v1'
      - '-DStorageAgent.InitialPingDelayInSeconds=10'

volumes:
  jadeconf:
